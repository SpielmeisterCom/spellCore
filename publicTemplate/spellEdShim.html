<!DOCTYPE html>
<html>
<head>
	<title>SpellEd</title>
	<link rel="stylesheet" href="main.css" type="text/css" />
	<script type="text/javascript" src="spell.js"></script>
</head>

<body>
<div id="spell"></div>
<script type="text/javascript">
	( function() {
		/**
		 * Thanks to John Resig. http://ejohn.org/blog/flexible-javascript-events/
		 *
		 * @param obj
		 * @param type
		 * @param fn
		 */
		var addEvent = function( obj, type, fn ) {
			if ( obj.attachEvent ) {
				obj['e'+type+fn] = fn;
				obj[type+fn] = function(){obj['e'+type+fn]( window.event );}
				obj.attachEvent( 'on'+type, obj[type+fn] );
			} else
				obj.addEventListener( type, fn, false );
		}

		var getParam = function( name ) {
			name = name.replace( /[\[]/, "\\\[" ).replace( /[\]]/, "\\\]" )
			var regexS = '[\\?&]' + name + '=([^&#]*)'
			var regex = new RegExp( regexS )
			var results = regex.exec( window.location.href )

			return ( results == null ? '' : results[ 1 ] )
		}

		var sendMessageToEditor = function( type, payload ) {
			parent.window.postMessage(
				{
					type : type,
					payload : payload,
					iframeId : getParam( 'iframeId' )
				},
				'*'
			)
		}

		var onInitialized = function() {
			sendMessageToEditor( 'spell.initialized' )
		}

		var handleMessageFromEditor = function( event ) {
			var index = event.data.type.indexOf( 'spelled.debug' )

			if( event.data.type.indexOf( 'spelled.debug' ) === 0 ) {
				spell.sendDebugMessage( event.data )
			}
		}

		var registerMessageHandler = function() {
			addEvent( window, 'message', handleMessageFromEditor )
		}

		registerMessageHandler()

		var config = {
			development : true,
			debug : true,
			platform : 'html5'
		}

		spell.start( config, onInitialized, sendMessageToEditor )
	} )()
</script>
</body>
</html>
